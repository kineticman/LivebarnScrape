version: '3.8'

services:
  livebarn:
    build: .
    container_name: livebarn-manager
    restart: unless-stopped

    # Host port (left side) is configurable via SERVER_PORT.
    # Container always listens on 5000 to match the healthcheck.
    ports:
      - "${SERVER_PORT:-5000}:5000"

    environment:
      # LiveBarn Credentials (REQUIRED)
      - LIVEBARN_EMAIL=${LIVEBARN_EMAIL}
      - LIVEBARN_PASSWORD=${LIVEBARN_PASSWORD}

      # Network Configuration (IMPORTANT - Set your LAN IP!)
      - LAN_IP=${LAN_IP:-192.168.1.100}  # Change to your server's LAN IP

      # External/public port (what clients should use in URLs)
      - PUBLIC_PORT=${SERVER_PORT:-5000}

      # Internal port the Flask app listens on (matches Dockerfile healthcheck)
      - SERVER_PORT=5000

      # Database path (must match volume mount)
      - DB_PATH=/data/livebarn.db

      - TZ=America/New_York  # Set your timezone for correct scheduling
      - LOG_LEVEL=INFO

    volumes:
      # Persistent database storage - bind mount to host directory
      - ./data:/data

    # Use host network mode for better LAN IP detection (optional)
    # Uncomment if you want the container to use your host's network directly
    # network_mode: host

    # If using host network mode, comment out the ports section above

# Note: No named volumes section needed when using bind mounts
# The ./data directory will be created on your host and persist across container restarts